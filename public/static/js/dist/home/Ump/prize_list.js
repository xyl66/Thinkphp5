$(function(){$(".j-order-deliver").click(function(){var a=$(this).data("id"),b=$(this).data("selfid"),c={self_id:b},d=_.template($("#tpl_order_lists_deliver").html(),c),e=$(d),f=e.find('input[name="is_self_take"]:checked').val();change_deliver(e,f),e.change(".send_deliver",function(){var a=e.find(".send_deliver").val();10==a?e.find(".express_class").removeClass("hide"):e.find(".express_class").addClass("hide")}),e.change('input[name="is_self_take"]',function(){var a=e.find('input[name="is_self_take"]:checked').val();change_deliver(e,a)}),$.jBox.show({width:600,height:600,title:"标记发货",content:e,btnOK:{onBtnClick:function(b){var c=e.find("select[name='deliver_wuliu']"),d=e.find("input[name='deliver_number']"),f=e.find("input[name='express_name']"),g=e.find("input[name='is_self_take']:checked"),h=e.find("select[name='self_address_id']"),i=c.val(),j=f.val(),k=d.val(),l=g.val(),m=h.val();if(0==l){if(""==i)return void HYD.FormShowError(c,"请选择物流公司");if(""==k)return void HYD.FormShowError(d,"请输入快递单号")}else if(1==l){if(0>m)return void HYD.FormShowError(h,"请选择自提地址");if(0==m){var n=e.find("input[name='name']"),o=e.find("input[name='mobile']"),p=e.find("input[name='phone']"),q=e.find("select[name='province_id']"),r=e.find("select[name='city_id']"),s=e.find("select[name='area_id']"),t=e.find("textarea[name='address']"),u=e.find("input[name='shop_name']"),j=n.val(),v=o.val(),w=p.val(),x=q.val(),y=r.val(),z=s.val(),A=u.val(),B=t.val();if(""==j)return void HYD.FormShowError(n,"联系人姓名不能为空");if(""==v)return void HYD.FormShowError(o,"手机号不能为空");if(0==x)return void HYD.FormShowError(q,"请选择省份");if(0==y)return void HYD.FormShowError(r,"请选择城市");if(0==z)return void HYD.FormShowError(s,"请选择地区");if(""==B)return void HYD.FormShowError(t,"请填写详细地址")}}$.jBox.close(b),$.ajax({url:"/Ump/prize_send_goods",type:"post",dataType:"json",data:{id:a,express:i,express_name:j,express_no:k,is_self_take:l,self_address_id:m,name:j,mobile:v,phone:w,province_id:x,city_id:y,area_id:z,address:B,shop_name:A},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，标记发货成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，标记发货失败："+a.msg),$.jBox.hideloading()}})}}})}),$(".j-self_address").click(function(){var a=$(this).data("id"),b=$(this).data("selfid"),c={self_id:b},d=_.template($("#tpl_order_slef_address").html(),c),e=$(d);e.change(".J-selectAddress",function(){var a=e.find("select[name='self_address_id']").val();0==a?($(".J-selfname").removeClass("hide"),$(".J-selfmobile").removeClass("hide"),$(".J-selfprovince").removeClass("hide"),$(".J-selfcity").removeClass("hide"),$(".J-selfarea").removeClass("hide"),$(".J-selfaddress").removeClass("hide"),$(".s_province").change(function(){var a=e.find(".s_province").val(),b='<option value="0">请选择</option>';pickerCity(a,function(a){$.each(a,function(a,c){b+="<option value='"+c.city_id+"'>"+c.city_name+"</option>"}),$(".s_city").empty().append(b)})}),e.find(".s_city").change(function(){var a=e.find(".s_city").val(),b='<option value="0">请选择</option>';pickerArea(a,function(a){$.each(a,function(a,c){b+="<option value='"+c.area_id+"'>"+c.area_name+"</option>"}),$(".s_area").empty().append(b)})})):($(".J-selfname").addClass("hide"),$(".J-selfmobile").addClass("hide"),$(".J-selfprovince").addClass("hide"),$(".J-selfcity").addClass("hide"),$(".J-selfarea").addClass("hide"),$(".J-selfaddress").addClass("hide"))}),$.jBox.show({width:600,height:600,title:"修改自提地址",content:e,btnOK:{onBtnClick:function(b){var c=e.find("select[name='self_address_id']"),d=c.val();if(0>d)return void HYD.FormShowError(c,"请选择自提地址");if(0==d){var f=e.find("input[name='name']"),g=e.find("input[name='mobile']"),h=e.find("input[name='phone']"),i=e.find("select[name='province_id']"),j=e.find("select[name='city_id']"),k=e.find("select[name='area_id']"),l=e.find("textarea[name='address']"),m=f.val(),n=g.val(),o=h.val(),p=i.val(),q=j.val(),r=k.val(),s=l.val();if(""==m)return void HYD.FormShowError(f,"联系人姓名不能为空");if(""==n)return void HYD.FormShowError(g,"手机号不能为空");if(0==p)return void HYD.FormShowError(i,"请选择省份");if(0==q)return void HYD.FormShowError(j,"请选择城市");if(0==r)return void HYD.FormShowError(k,"请选择地区");if(""==s)return void HYD.FormShowError(l,"请填写详细地址")}$.jBox.close(b),$.ajax({url:"/Ump/ajax_slef_address",type:"post",dataType:"json",data:{id:a,self_address_id:d,name:m,mobile:n,phone:o,province_id:p,city_id:q,area_id:r,address:s},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+a.msg),$.jBox.hideloading()}})}}})}),$(".j-no-deliver").click(function(){var a=$(this).data("id");$.jBox.show({width:500,title:"标记发货",content:_.template($("#tpl_jbox_simple").html(),{content:"确认发货吗？"}),btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/Ump/prize_send_goods",type:"post",dataType:"json",data:{id:a,type:1},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，标记发货成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，标记发货失败："+a.msg),$.jBox.hideloading()}})}}})}),$(".J_batch_deliver").click(function(){var a=[],b=$(".table-ckbs:checked");if(b.each(function(){a.push($(this).data("id"))}),!a.length)return void HYD.hint("warning","对不起，请选择要发货的订单！");var c=$("#tpl_order_lists_deliver").html(),c=_.template(c,{self_id:0}),d=$(c),e=d.find('input[name="is_self_take"]:checked').val();return change_deliver(d,e),d.change(".send_deliver",function(){var a=d.find(".send_deliver").val();10==a?d.find(".express_class").removeClass("hide"):d.find(".express_class").addClass("hide")}),d.change('input[name="is_self_take"]',function(){var a=d.find('input[name="is_self_take"]:checked').val();change_deliver(d,a)}),d.find('select[name="province_id"]').change(function(a){var b=d.find('.select[name="province_id"]').val();change_deliver(d,b)}),$.jBox.show({width:600,height:600,title:"批量发货",content:d,btnOK:{onBtnClick:function(b){var c=d.find("select[name='deliver_wuliu']"),e=d.find("input[name='deliver_number']"),f=d.find("input[name='express_name']"),g=d.find("input[name='is_self_take']:checked"),h=c.val(),i=f.val(),j=e.val(),k=g.val(),l=d.find("select[name='self_address_id']"),h=c.val(),i=f.val(),j=e.val(),k=g.val(),m=l.val();if(k){if(1==k){if(0>m)return void HYD.FormShowError(l,"请选择自提地址");if(0==m){var n=d.find("input[name='name']"),o=d.find("input[name='mobile']"),p=d.find("select[name='province_id']"),q=d.find("select[name='city_id']"),r=d.find("select[name='area_id']"),s=d.find("textarea[name='address']"),i=n.val(),t=o.val(),u=p.val(),v=q.val(),w=r.val(),x=s.val();if(""==i)return void HYD.FormShowError(n,"联系人姓名不能为空");if(""==t)return void HYD.FormShowError(o,"手机号不能为空");if(0==u)return void HYD.FormShowError(p,"请选择省份");if(0==v)return void HYD.FormShowError(q,"请选择城市");if(0==w)return void HYD.FormShowError(r,"请选择地区");if(""==x)return void HYD.FormShowError(s,"请填写详细地址")}}}else{if(""==h)return void HYD.FormShowError(c,"请选择物流公司");if(""==j)return void HYD.FormShowError(e,"请输入快递单号")}$.jBox.close(b),$.ajax({url:"/Order/batch_deliver",type:"post",dataType:"json",data:{ids:a,express:h,express_name:i,express_no:j,is_self_take:k,self_address_id:m,name:i,mobile:t,province_id:u,city_id:v,area_id:w,address:x},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?HYD.hint("success","恭喜您，批量发货成功！"):HYD.hint("danger","对不起，批量发货失败："+a.msg),setTimeout(function(){window.location.reload()},1e3),$.jBox.hideloading()}})}}}),!1}),$(".j-confrimpay").click(function(){var a=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认付款后将不可恢复，是否继续？"}),btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/Order/comfrimPay",type:"post",dataType:"json",data:{id:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-order-express").click(function(){var a=$(this).data("id"),b=$(this).data("express"),c=$(this).data("no"),d=$(this).data("name"),e={express:b,express_no:c,express_name:d},f=_.template($("#tpl_order_lists_express").html(),e),g=$(f);10==b?g.find(".express_class").removeClass("hide"):g.find(".express_class").addClass("hide"),g.change(".send_deliver",function(){var a=g.find(".send_deliver").val();10==a?g.find(".express_class").removeClass("hide"):g.find(".express_class").addClass("hide")}),$.jBox.show({width:500,title:"修改快递信息",content:g,btnOK:{onBtnClick:function(b){var c=g.find("select[name='deliver_wuliu']"),d=g.find("input[name='deliver_number']"),e=g.find("input[name='express_name']"),f=c.val(),h=e.val(),i=d.val();return""==f?void HYD.FormShowError(c,"请选择物流公司"):""==i?void HYD.FormShowError(d,"请输入快递单号"):($.jBox.close(b),void $.ajax({url:"/Ump/PrizeSaveExpressno",type:"post",dataType:"json",data:{id:a,express:f,express_name:h,express_no:i},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+a.msg),$.jBox.hideloading()}}))}}})}),$(".j-confirm-order").click(function(){var a=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认标记收货吗？"}),btnOK:{onBtnClick:function(b){$.jBox.close(b),$.ajax({url:"/Ump/ConfirmOrder",type:"post",dataType:"json",data:{id:a},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+a.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-update-address").click(function(){var a=$(this).data("id"),b=$(this).data("name"),c=$(this).data("mobile"),d=$(this).data("address"),e={name:b,mobile:c,address:d},f=_.template($("#tpl_order_lists_address").html(),e),g=$(f);$.jBox.show({width:500,title:"修改收货地址",content:g,btnOK:{onBtnClick:function(b){var c=g.find("input[name='name']"),d=g.find("input[name='mobile']"),e=g.find("input[name='address']"),f=c.val(),h=d.val(),i=e.val();return""==f?void HYD.FormShowError(c,"收货人姓名不能为空"):""==h?void HYD.FormShowError(d,"手机号不能为空"):""==i?void HYD.FormShowError(e,"收货地址不能为空"):($.jBox.close(b),void $.ajax({url:"/Ump/ajaxSaveAddress",type:"post",dataType:"json",data:{id:a,name:f,mobile:h,address:i},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，修改成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+a.msg),$.jBox.hideloading()}}))}}})})});var pickerCity=function(a,b){$.ajax({url:"/System/getCity",type:"post",dataType:"json",data:{province_id:a},success:function(a){1==a.status&&b&&b(a.data)}})},pickerArea=function(a,b){$.ajax({url:"/System/getArea",type:"post",dataType:"json",data:{city_id:a},success:function(a){1==a.status&&b&&b(a.data)}})},change_deliver=function(a,b){if(1==b){a.find(".J_express_company").addClass("hide"),a.find(".express_class").addClass("hide"),a.find(".J_express_no").addClass("hide"),a.find(".J_select_address").removeClass("hide");var c=a.find("select[name='self_address_id']").val();0==c?(a.find(".J-name").removeClass("hide"),a.find(".J-mobile").removeClass("hide"),a.find(".J-province").removeClass("hide"),a.find(".J-city").removeClass("hide"),a.find(".J-area").removeClass("hide"),a.find(".J-address").removeClass("hide"),a.find(".s_province").change(function(){var b=a.find(".s_province").val(),c='<option value="0">请选择</option>';pickerCity(b,function(a){$.each(a,function(a,b){c+="<option value='"+b.city_id+"'>"+b.city_name+"</option>"}),$(".s_city").empty().append(c)})}),a.find(".s_city").change(function(){var b=a.find(".s_city").val(),c='<option value="0">请选择</option>';pickerArea(b,function(a){$.each(a,function(a,b){c+="<option value='"+b.area_id+"'>"+b.area_name+"</option>"}),$(".s_area").empty().append(c)})})):(a.find(".J-name").addClass("hide"),a.find(".J-mobile").addClass("hide"),a.find(".J-province").addClass("hide"),a.find(".J-city").addClass("hide"),a.find(".J-area").addClass("hide"),a.find(".J-address").addClass("hide"))}else{a.find(".J_express_company").removeClass("hide"),a.find(".J_express_no").removeClass("hide"),a.find(".J_select_address").addClass("hide"),a.find(".J-name").addClass("hide"),a.find(".J-mobile").addClass("hide"),a.find(".J-province").addClass("hide"),a.find(".J-city").addClass("hide"),a.find(".J-area").addClass("hide"),a.find(".J-address").addClass("hide");var b=a.find(".send_deliver").val();10==b?a.find(".express_class").removeClass("hide"):a.find(".express_class").addClass("hide")}};