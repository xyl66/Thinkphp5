$(function(){$(document).on("click",".j-getedit",function(a){$(this).siblings(".editinfo").show(),$(this).closest(".goodswrap").addClass("cur")}),$(document).on("click",".j-geteditstock",function(a){$(this).closest(".stockwrap").addClass("cur").closest("tr").siblings("tr").find(".stockwrap").removeClass("cur");var b=0,c=$(this).data("sku"),d=$(this).data("id");if(c){for(var e=0;e<c.length;e++){var f=c[e];b+=parseInt(f.num)}var g='<div class="skuprice style="left:0;""><i class="Jcancel">&times;</i><div>总库存：'+b+"</div>";$.each(c,function(a,b){g+='<div class="sku-item"><label for=""><span>'+b.skuname+'：</span><input type="text" name="sku_num" value="'+b.num+'" /><input type="hidden" value="'+b.sku_id+'"></label></div>'})}else{var h=$(this).data("num"),g='<div class="skuprice style="left:0;""><i class="Jcancel">&times;</i><div>总库存：'+h+"</div>";g+='<div class="sku-item"><label for=""><span>修改库存：</span><input type="text" class="mini" name="num" value="'+h+'" /></label></div>'}g+='<p><a href="javascript:;" class="j-safestock" title="保存修改库存"  data-id="'+d+'">保存</a></p></div>',$(this).closest(".stockwrap").append(g)}),$(document).on("click",".j-safestock",function(a){var b=[],c=[],d=$(this).data("id"),e=$('.skuprice input[name="num"]').val();$(".skuprice").children(".sku-item").each(function(){var a=$(this).find('input[name="sku_num"]').val(),d=$(this).find('input[type="hidden"]').val();b.push(a),c.push(d)}),$.post("/Item/ajax_item_edit",{num:e,type:3,item_id:d,sku_num:b,sku_id:c},function(a){1==a.status?(HYD.hint("success","恭喜您，保存成功!"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，保存失败："+a.msg)}),$(this).closest(".skuprice").remove()}),$(document).on("click",".j-getprice",function(a){$(this).closest(".goodswrap").addClass("cur");var b=$(this).data("sku"),c=$(this).data("id"),d='<div class="skuprice"><i class="Jcancel">&times;</i>';if(b)$.each(b,function(a,b){d+='<div class="sku-item"><label for=""><span>'+b.skuname+'：</span><input type="text" class="mini" name="sku_price" value="'+b.price+'" /><input type="hidden" value="'+b.sku_id+'"></label></div>'});else{var e=$(this).data("price");d+='<div class="sku-item"><label for=""><span>修改价格：</span><input type="text" class="mini" name="price" value="'+e+'" /></label></div>'}d+='<p><a href="javascript:;" class="j-safeprice" title="保存修改价格" data-id="'+c+'">保存</a></p></div>',$(this).closest(".goodswrap").append(d)}),$(document).on("click",".Jcancel",function(a){$(this).closest(".skuprice").remove(),$(this).closest(".goodswrap,.stockwrap").removeClass("cur")}),$(document).on("click",".j-safetitle",function(a){var b=$(this).prev().html(),c=$(this).data("id");$.post("/Item/ajax_item_edit",{title:b,type:1,item_id:c},function(a){1==a.status?(HYD.hint("success","恭喜您，保存成功!"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，保存失败："+a.msg)}),$(this).closest(".editinfo").hide(),$(this).closest(".goodswrap").removeClass("cur")}),$(document).on("click",".j-safeprice",function(a){var b=[],c=[],d=$(this).data("id"),e=$('.skuprice input[name="price"]').val();$(".skuprice").children(".sku-item").each(function(){var a=$(this).find('input[name="sku_price"]').val(),d=$(this).find('input[type="hidden"]').val();b.push(a),c.push(d)}),$.post("/Item/ajax_item_edit",{price:e,type:2,item_id:d,sku_price:b,sku_id:c},function(a){1==a.status?(HYD.hint("success","恭喜您，保存成功!"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，保存失败："+a.msg)}),$(this).closest(".skuprice").remove(),$(this).closest(".goodswrap").removeClass("cur")}),$(document).on("click",".j-geteditserial",function(a){$(this).closest(".serialwrap").addClass("cur");var b=$(this).data("id"),c=$(this).data("serial"),d='<div class="skuprice" style="left:0;"><i class="Jcancel">&times;</i><div>排序号：'+c+"</div>";d+='<div class="sku-item"><label for=""><span>修改排序：</span><input type="text" class="mini" name="serial" value="'+c+'" /></label></div>',d+='<p><a href="javascript:;" class="j-safeserial" title="保存修改排序"  data-id="'+b+'">保存</a></p></div>',$(this).closest(".serialwrap").append(d)}),$(document).on("click",".j-safeserial",function(a){var b=$(this).data("id"),c=$('.skuprice input[name="serial"]').val();$.post("/Item/ajax_item_edit",{serial:c,type:4,item_id:b},function(a){1==a.status?(HYD.hint("success","恭喜您，保存成功!"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，保存失败："+a.msg)}),$(this).closest(".skuprice").remove()}),$(document).on("click",".j-geteditclassName",function(a){var b=$(this).data("id"),c=$(this).data("cid"),d={class_id:c},e=_.template($("#tpl_item_class").html(),d),f=$(e);$.jBox.show({width:420,title:"编辑产品分类",content:f,btnOK:{onBtnClick:function(a){var c=a.find('select[name="class_id"]').val();console.log(c),console.log(b),$.jBox.close(a),$.ajax({url:"/Item/ajax_item_edit",type:"post",dataType:"json",data:{class_id:c,type:5,item_id:b},beforeSend:function(){$.jBox.showloading()},success:function(a){1==a.status?(HYD.hint("success","恭喜您，保存成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，保存失败："+a.msg),$.jBox.hideloading()}})}}})})});